<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Making 17 - Point Settings</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <style>
    /* CSS 변수 정의 */
    :root {
      --primary-color: #6c46ef;
      --background-color: #f7f8fa;
      --card-background-color: #fff;
      --border-color: #eee;
      --text-color: #333;
      --sub-text-color: #999;
      --active-tab-color: #fff;
      --active-tab-bg: #6c46ef;
      --tab-inactive-bg: #e9ecef;
      --active-rate-bg: #e0d8f8;
      --swiper-bullet-active-bg: var(--primary-color);
      --graph-bg: #e9ecef;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
        'Helvetica Neue', Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      background-color: var(--background-color);
    }

    /* Header */
    .header {
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--text-color);
    }

    .header p {
      font-size: 0.875rem;
      color: var(--sub-text-color);
    }

    /* AI Recommendation Section */
    .ai-recommendation-section {
      background-color: var(--card-background-color);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .ai-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .ai-header h2 {
      font-size: 1.125rem;
      font-weight: bold;
    }

    .ai-content {
      transition: all 0.3s ease;
    }

    /* AI 섹션을 숨기기 위한 클래스 */
    .ai-content.hidden {
      display: none;
    }

    .ai-description {
      font-size: 0.8rem;
      color: var(--sub-text-color);
      margin-bottom: 20px;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-label {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 24px;
    }

    .toggle-label:before {
      position: absolute;
      content: '';
      height: 20px;
      width: 20px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    .toggle-input:checked+.toggle-label {
      background-color: var(--primary-color);
    }

    .toggle-input:checked+.toggle-label:before {
      transform: translateX(20px);
    }

    /* AI Swiper */
    .ai-swiper {
      position: relative;
      padding-bottom: 30px;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
    }

    .ai-swiper .swiper-wrapper {
      align-items: stretch;
    }

    .ai-slide {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: var(--card-background-color);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      height: 120px;
      min-width: 100px;
    }

    /* 원형 그래프 스타일 */
    .circular-progress-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .circular-progress {
      width: 50px;
      height: 50px;
      transform: rotate(-90deg);
      margin-bottom: 5px;
    }

    .circular-progress-bg {
      fill: none;
      stroke: var(--graph-bg);
      stroke-width: 8;
    }

    .circular-progress-markers {
      fill: none;
      stroke: #d1d5db;
      stroke-width: 4;
      stroke-linecap: round;
      stroke-dashoffset: 0;
    }

    .circular-progress-bar {
      fill: none;
      stroke: var(--primary-color);
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease-in-out;
    }

    .circular-progress-text {
      font-size: 2.0rem;
      font-weight: bold;
      fill: var(--text-color);
      transform: rotate(90deg);
      transform-origin: center;
    }

    .circular-progress-label {
      font-size: 0.875rem;
      color: var(--sub-text-color);
    }

    .swiper-pagination.ai-swiper-pagination {
      bottom: 0;
    }

    .swiper-pagination-bullet {
      width: 8px;
      height: 8px;
      background-color: #d1d5db;
      opacity: 1;
      border-radius: 50%;
      transition: width 0.3s;
    }

    .swiper-pagination-bullet-active {
      width: 18px;
      background-color: var(--swiper-bullet-active-bg);
      border-radius: 4px;
    }

    /* Tabs Section */
    .tabs-section {
      padding-bottom: 20px;
    }

    .tabs {
      display: flex;
      justify-content: space-around;
      background-color: var(--tab-inactive-bg);
      border-radius: 8px;
      padding: 4px;
      margin-bottom: 20px;
    }

    .tab-button {
      flex: 1;
      background-color: transparent;
      border: none;
      padding: 10px 0;
      border-radius: 8px;
      font-weight: bold;
      font-size: 0.9rem;
      color: var(--sub-text-color);
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    .tab-button.active {
      background-color: var(--active-tab-bg);
      color: var(--active-tab-color);
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* Grid Layout for Items */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }

    .item-card {
      background-color: var(--card-background-color);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border: 1px solid var(--border-color);
      transition: border-color 0.3s, background-color 0.3s;
    }

    .item-card.is-active {
      border: 2px solid var(--primary-color);
      background-color: var(--active-rate-bg);
    }

    .item-card.is-active .item-link,
    .item-card.is-active .rate-control {
      color: var(--text-color);
    }

    .item-card.is-active .item-link .icon,
    .item-card.is-active .rate-control button {
      color: var(--primary-color);
    }

    .item-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: inherit;
      margin-bottom: 12px;
    }

    .item-link .icon {
      font-size: 1.5rem;
      color: var(--primary-color);
      margin-right: 12px;
    }

    .item-link .label {
      font-weight: bold;
      flex-grow: 1;
    }

    .item-link .arrow {
      color: var(--sub-text-color);
    }

    .rate-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--background-color);
      border-radius: 20px;
      padding: 4px;
    }

    .rate-control button {
      background-color: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 1.2rem;
      font-weight: bold;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.2s;
    }

    .rate-control button:hover {
      background-color: rgba(108, 70, 239, 0.1);
    }

    .rate-control button:disabled {
      color: #ccc;
      cursor: not-allowed;
    }

    .rate-control button:disabled:hover {
      background-color: transparent;
    }

    .rate-control .rate-value {
      font-weight: bold;
      color: var(--text-color);
      min-width: 40px;
      text-align: center;
    }

    /* Total Points Section */
    .total-section {
      background-color: var(--primary-color);
      color: var(--active-tab-color);
      padding: 20px;
      border-radius: 16px;
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .total-section h3 {
      font-size: 1rem;
      font-weight: normal;
      margin-bottom: 5px;
    }

    .total-section .total-rate {
      font-size: 2.5rem;
      font-weight: bold;
    }

    .total-section .total-rate.target-reached {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* New Buttons Section */
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      width: 100%;
    }

    .button-group button {
      flex: 1;
      padding: 16px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .all-1-button {
      background-color: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }

    .all-1-button:active {
      background-color: rgba(108, 70, 239, 0.1);
    }

    .next-button {
      background-color: var(--primary-color);
      border: none;
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .next-button:active {
      transform: scale(0.98);
    }
  </style>
</head>

<body>

  <div class="container">
    <header class="header">
      <h1>Making 17</h1>
      <p>포인트 적립률은 영역별 1~5%이며 적립률의 환산이 17%가 되도록 설정해주세요.</p>
    </header>

    <section class="ai-recommendation-section">
      <div class="ai-header">
        <h2>AI 추천항목</h2>
        <div class="toggle-switch">
          <input type="checkbox" id="ai-toggle" class="toggle-input" role="switch" aria-checked="true" checked>
          <label for="ai-toggle" class="toggle-label"></label>
        </div>
      </div>
      <div class="ai-content">
        <p class="ai-description">
          AI가 추천하는 영역과 적립률입니다. 반드시 최대의 적립을 보장하지는 않으며, 직접 수정할 수 있습니다.
        </p>

        <div class="swiper ai-swiper">
          <div class="swiper-wrapper">
            <!-- AI 추천 슬라이드는 JavaScript로 동적 생성됩니다. -->
          </div>
          <div class="swiper-pagination ai-swiper-pagination"></div>
        </div>
      </div>
    </section>

    <section class="tabs-section">
      <div class="tabs" role="tablist">
        <button class="tab-button active" data-tab="shopping" role="tab" aria-selected="true"
          id="tab-shopping">쇼핑</button>
        <button class="tab-button" data-tab="lifestyle" role="tab" aria-selected="false" id="tab-lifestyle"
          tabindex="-1">생활</button>
        <button class="tab-button" data-tab="food" role="tab" aria-selected="false" id="tab-food"
          tabindex="-1">푸드</button>
        <button class="tab-button" data-tab="travel" role="tab" aria-selected="false" id="tab-travel"
          tabindex="-1">여행</button>
      </div>

      <div class="tab-content-container">
        <!-- 동적으로 생성된 카드가 여기에 표시됩니다 -->
        <div id="tab-shopping-panel" class="tab-panel active" role="tabpanel">
          <div class="grid-container">
            <!-- JavaScript가 여기에 카드를 동적으로 추가합니다. -->
          </div>
        </div>
        <div id="tab-lifestyle-panel" class="tab-panel" role="tabpanel" hidden>
          <div class="grid-container"></div>
        </div>
        <div id="tab-food-panel" class="tab-panel" role="tabpanel" hidden>
          <div class="grid-container"></div>
        </div>
        <div id="tab-travel-panel" class="tab-panel" role="tabpanel" hidden>
          <div class="grid-container"></div>
        </div>
      </div>
    </section>

    <section class="total-section">
      <h3>총 적립률</h3>
      <span id="total-rate" class="total-rate">0%</span>
    </section>

    <div class="button-group">
      <button class="all-1-button" id="all-1-button">모든 영역 1% 설정</button>
      <button class="next-button" id="next-button">다음</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // AI 추천 슬라이드 데이터 (원형 그래프를 위해 동적 생성)
      const aiRecommendedRates = [
        { label: '소셜 커머스', rate: 4 },
        { label: '패션&뷰티', rate: 1 },
        { label: '병원', rate: 2 },
        { label: '기타', rate: 3 },
        { label: '기타', rate: 3 },
        { label: '기타', rate: 3 },
      ];

      // 개별 그래프를 부드럽게 애니메이션하는 함수
      const animateCircularProgress = (slideElement, targetRate) => {
        console.log(slideElement, targetRate);

        const progressBar = slideElement.querySelector('.circular-progress-bar');
        const rateText = slideElement.querySelector('.circular-progress-text');
        if (!progressBar || !rateText) return;

        const radius = 45;
        const circumference = 2 * Math.PI * radius;
        // 5%가 100% 진행률에 해당
        const targetPercentage = targetRate * 20;
        const duration = 500; // 0.5초 동안 애니메이션
        const startOffset = circumference;
        const endOffset = circumference - (circumference * targetPercentage / 100);
        const startTime = performance.now();

        const animateStep = (timestamp) => {
          const elapsed = timestamp - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const currentOffset = startOffset + (endOffset - startOffset) * progress;
          const currentPercentage = targetPercentage * progress;

          progressBar.style.strokeDashoffset = currentOffset;
          rateText.textContent = `${Math.round(currentPercentage / 20)}%`;

          if (progress < 1) {
            requestAnimationFrame(animateStep);
          } else {
            // 애니메이션이 끝난 후 최종 상태를 정확히 설정
            progressBar.style.strokeDashoffset = endOffset;
            rateText.textContent = `${targetRate}%`;
          }
        };

        // 애니메이션 시작 전 초기 상태 설정
        progressBar.style.strokeDashoffset = startOffset;
        rateText.textContent = '0%';
        requestAnimationFrame(animateStep);
      };

      // Swiper 슬라이드 생성 및 애니메이션 적용 함수
      const createAiSlides = () => {
        const swiperWrapper = document.querySelector('.ai-swiper .swiper-wrapper');
        if (!swiperWrapper) return;

        swiperWrapper.innerHTML = '';
        const radius = 45;
        const circumference = 2 * Math.PI * radius;
        const segmentDash = (circumference / 100) - 0.5;
        const segmentGap = 0.5;

        aiRecommendedRates.forEach(item => {
          const slideHTML = `
            <div class="swiper-slide ai-slide">
              <div class="circular-progress-container">
                <svg class="circular-progress" viewBox="0 0 100 100">
                  <circle class="circular-progress-bg" cx="50" cy="50" r="${radius}"></circle>
                  <circle class="circular-progress-markers" cx="50" cy="50" r="${radius}" 
                          stroke-dasharray="${segmentDash}, ${segmentGap}"></circle>
                  <circle class="circular-progress-bar" cx="50" cy="50" r="${radius}" 
                          style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${circumference};"></circle>
                  <text x="50%" y="50%" text-anchor="middle" dy=".3em" class="circular-progress-text">0%</text>
                </svg>
                <span class="circular-progress-label">${item.label}</span>
              </div>
            </div>
          `;
          swiperWrapper.insertAdjacentHTML('beforeend', slideHTML);
          const newSlide = swiperWrapper.lastElementChild;
          animateCircularProgress(newSlide, item.rate);
        });
      };

      // 초기 슬라이드 생성
      createAiSlides();

      // Swiper 초기화
      const aiSwiper = new Swiper('.ai-swiper', {
        slidesPerView: 'auto',
        spaceBetween: 10,
        loop: false,
        pagination: {
          el: '.ai-swiper-pagination',
          clickable: true,
        },
        observer: true,
        observeParents: true,
        breakpoints: {
          320: {
            slidesPerView: 1,
            slidesPerGroup: 1,
            spaceBetween: 10
          },
          768: {
            slidesPerView: 2,
            slidesPerGroup: 2,
            spaceBetween: 10
          },
          1024: {
            slidesPerView: 3,
            slidesPerGroup: 3,
            spaceBetween: 10
          }
        },
        // Swiper 슬라이드 변경 시 애니메이션 재시작
        on: {
          slideChangeTransitionEnd: (swiper) => {
            swiper.slides.forEach(slide => {
              // 현재 보이는 슬라이드에 대해서만 애니메이션을 다시 시작
              if (slide.classList.contains('swiper-slide-active')) {
                const rateLabel = slide.querySelector('.circular-progress-text');

                const item = aiRecommendedRates.find(data => data.label === rateLabel.textContent);
                console.log(rateLabel.innerHTML.replace("%", ''));
                animateCircularProgress(slide, rateLabel.innerHTML.replace("%", ''));
                // if (item) {
                //   animateCircularProgress(slide, item);
                // }
              }
            });


          }
          // slideChange: () => {
          //   console.log('thumbsSwiper sslideChange');
          //   aiSwiper.slides.forEach(slide => {
          //     if (slide.classList.contains('swiper-slide-next')) {
          //       const rateLabel = slide.querySelector('.circular-progress-text');
          //       console.log(rateLabel.innerHTML.replace("%", ''));
          //       const item = aiRecommendedRates.find(data => data.label === rateLabel.textContent);
          //       if (rateLabel.innerHTML.replace("%", '')) {
          //         animateCircularProgress(slide, rateLabel.innerHTML.replace("%", ''));
          //       }
          //     }
          //   });
          // }
        }
      });


      // --- 탭 기능 ---
      const tabs = document.querySelectorAll('.tab-button');
      const panels = document.querySelectorAll('.tab-panel');
      const totalRateElement = document.getElementById('total-rate');
      const aiToggle = document.getElementById('ai-toggle');
      const aiContent = document.querySelector('.ai-content');

      // 동적으로 생성할 카드 데이터 배열
      const cardData = [
        // 쇼핑 카테고리
        { category: 'shopping', label: '백화점', iconClass: 'fas fa-store', href: 'https://www.shinhancard.com/' },
        { category: 'shopping', label: '마트', iconClass: 'fas fa-shopping-basket', href: 'https://www.shinhancard.com/' },
        { category: 'shopping', label: '홈 쇼핑', iconClass: 'fas fa-laptop', href: 'https://www.shinhancard.com/' },
        { category: 'shopping', label: '온라인 쇼핑', iconClass: 'fas fa-shopping-bag', href: 'https://www.shinhancard.com/' },
        { category: 'shopping', label: '소셜 커머스', iconClass: 'fas fa-users', href: 'https://www.shinhancard.com/' },
        { category: 'shopping', label: '패션&뷰티', iconClass: 'fas fa-magic', href: 'https://www.shinhancard.com/' },
        // 생활 카테고리
        { category: 'lifestyle', label: '주유', iconClass: 'fas fa-gas-pump', href: 'https://www.shinhancard.com/' },
        { category: 'lifestyle', label: '통신', iconClass: 'fas fa-phone', href: 'https://www.shinhancard.com/' },
        { category: 'lifestyle', label: '병원', iconClass: 'fas fa-hospital', href: 'https://www.shinhancard.com/' },
        { category: 'lifestyle', label: '약국', iconClass: 'fas fa-prescription-bottle-alt', href: 'https://www.shinhancard.com/' },
        // 푸드 카테고리
        { category: 'food', label: '카페', iconClass: 'fas fa-coffee', href: 'https://www.shinhancard.com/' },
        { category: 'food', label: '레스토랑', iconClass: 'fas fa-utensils', href: 'https://www.shinhancard.com/' },
        { category: 'food', label: '베이커리', iconClass: 'fas fa-cookie-bite', href: 'https://www.shinhancard.com/' },
        { category: 'food', label: '음료', iconClass: 'fas fa-cocktail', href: 'https://www.shinhancard.com/' },
        // 여행 카테고리
        { category: 'travel', label: '항공', iconClass: 'fas fa-plane', href: 'https://www.shinhancard.com/' },
        { category: 'travel', label: '호텔', iconClass: 'fas fa-hotel', href: 'https://www.shinhancard.com/' },
        { category: 'travel', label: '렌터카', iconClass: 'fas fa-car', href: 'https://www.shinhancard.com/' },
        { category: 'travel', label: '기타', iconClass: 'fas fa-suitcase-rolling', href: 'https://www.shinhancard.com/' },
      ];

      // AI 추천 적립률을 객체로 변환하여 사용
      const aiRatesMap = aiRecommendedRates.reduce((acc, curr) => {
        acc[curr.label] = curr.rate;
        return acc;
      }, {});

      // 카드별 현재 적립률을 저장할 객체. 초기값 설정.
      let cardRates = {};
      const initialAIToggleState = aiToggle.checked;
      if (initialAIToggleState) {
        cardRates = { ...aiRatesMap };
      }

      // 총 적립률을 계산하고 표시하는 함수
      const updateTotalRateDisplay = () => {
        const total = Object.values(cardRates).reduce((sum, rate) => sum + rate, 0);
        totalRateElement.textContent = `${total}%`;
        if (total === 17) {
          totalRateElement.classList.add('target-reached');
        } else {
          totalRateElement.classList.remove('target-reached');
        }
      };

      // 카드를 동적으로 렌더링하는 함수
      const renderCards = (category) => {
        const gridContainer = document.querySelector(`#tab-${category}-panel .grid-container`);
        if (!gridContainer) return;

        gridContainer.innerHTML = ''; // 기존 카드 제거
        const filteredCards = cardData.filter(card => card.category === category);
        const isAIToggleChecked = aiToggle.checked;

        filteredCards.forEach(item => {
          const cardElement = document.createElement('div');
          cardElement.className = 'item-card';

          const currentRate = cardRates[item.label] || 0;
          if (currentRate > 0) {
            cardElement.classList.add('is-active');
          }

          cardElement.innerHTML = `
            <a href="${item.href}" class="item-link" aria-label="${item.label} 상세 정보 보기">
              <i class="${item.iconClass} icon"></i>
              <span class="label">${item.label}</span>
              <i class="fas fa-chevron-right arrow"></i>
            </a>
            <div class="rate-control">
              <button class="minus" aria-label="${item.label} 적립률 감소" ${isAIToggleChecked ? 'disabled' : ''}>-</button>
              <span class="rate-value" role="status" aria-live="polite">${currentRate}%</span>
              <button class="plus" aria-label="${item.label} 적립률 증가" ${isAIToggleChecked ? 'disabled' : ''}>+</button>
            </div>
          `;

          // 이벤트 리스너를 동적으로 추가
          const minusBtn = cardElement.querySelector('.minus');
          const plusBtn = cardElement.querySelector('.plus');
          const rateValueSpan = cardElement.querySelector('.rate-value');

          minusBtn.addEventListener('click', () => {
            let currentValue = cardRates[item.label] || 0;
            if (currentValue > 0) {
              currentValue--;
              cardRates[item.label] = currentValue; // 상태 업데이트
              rateValueSpan.textContent = `${currentValue}%`;
              if (currentValue === 0) {
                cardElement.classList.remove('is-active');
              }
              updateTotalRateDisplay();
            }
          });

          plusBtn.addEventListener('click', () => {
            let currentValue = cardRates[item.label] || 0;
            if (currentValue < 5) {
              currentValue++;
              cardRates[item.label] = currentValue; // 상태 업데이트
              rateValueSpan.textContent = `${currentValue}%`;
              if (currentValue > 0) {
                cardElement.classList.add('is-active');
              }
              updateTotalRateDisplay();
            }
          });
          gridContainer.appendChild(cardElement);
        });
      };

      // 탭 클릭 이벤트 리스너
      tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
          const targetTab = e.target;
          const category = targetTab.dataset.tab;
          const targetPanel = document.querySelector(`#tab-${category}-panel`);

          // 모든 탭 및 패널 비활성화
          tabs.forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
            t.setAttribute('tabindex', '-1');
          });
          panels.forEach(p => {
            p.classList.remove('active');
            p.setAttribute('hidden', '');
          });

          // 클릭된 탭 및 해당 패널 활성화
          targetTab.classList.add('active');
          targetTab.setAttribute('aria-selected', 'true');
          targetTab.setAttribute('tabindex', '0');
          targetPanel.classList.add('active');
          targetPanel.removeAttribute('hidden');
          // 카드를 동적으로 렌더링
          renderCards(category);
        });
      });

      // AI 추천 토글 스위치 이벤트 리스너
      aiToggle.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        if (isChecked) {
          // AI 추천 콘텐츠 표시
          aiContent.classList.remove('hidden');
          // AI 추천 적용: 모든 적립률 초기화 후 AI 추천값으로 설정
          cardRates = { ...aiRatesMap };
        } else {
          // AI 추천 콘텐츠 숨기기
          aiContent.classList.add('hidden');
          // 수동 설정: 모든 적립률을 0으로 초기화
          cardRates = {};
        }

        // 현재 활성화된 탭의 카드를 다시 렌더링하여 UI 업데이트
        const activeTab = document.querySelector('.tab-button.active');
        const activeCategory = activeTab.dataset.tab;
        renderCards(activeCategory);
        updateTotalRateDisplay();
      });

      // '모든 영역 1% 설정' 버튼 이벤트 리스너
      document.getElementById('all-1-button').addEventListener('click', () => {
        // AI 추천 토글 해제 및 UI 업데이트
        aiToggle.checked = false;
        aiContent.classList.add('hidden');

        // 모든 카드의 적립률을 1%로 설정
        cardData.forEach(item => {
          cardRates[item.label] = 1;
        });

        // 현재 활성화된 탭의 카드를 다시 렌더링하여 UI 업데이트
        const activeTab = document.querySelector('.tab-button.active');
        const activeCategory = activeTab.dataset.tab;
        renderCards(activeCategory);

        updateTotalRateDisplay();
      });

      // '다음' 버튼 이벤트 리스너
      document.getElementById('next-button').addEventListener('click', () => {
        console.log('다음 단계로 이동합니다.');
        // 실제 애플리케이션에서는 여기에 다음 페이지로 이동하는 로직을 추가합니다.
      });

      // 초기 렌더링: '쇼핑' 탭의 카드들을 표시
      renderCards('shopping');
      updateTotalRateDisplay();
    });
  </script>
</body>

</html>